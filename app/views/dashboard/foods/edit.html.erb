require "test_helper"

describe Dashboard::FoodsController do
  let(:establishment) { establishments(:one)  }
  let(:food) { Food.create name: 'Taco de asada',
               price: 12.00, description: 'Bistec a la parrilla',
               establishment_id: 100 }

  describe 'GET index' do
    it 'should displays foods of a establishment with logged user' do
      login_user

      get :index, establishment_id: establishment.id

      must_response_with :success
      must_render_template :index
    end

    it 'should not display foods when not logged user' do
      get :index, establishment_id: establishment.id

      must_redirect_to root_path
      flash[:alert].wont_be_nil
    end
  end

  describe 'GET show' do
    it 'should display food that a establishment when for logged user' do
      login_user

      get :show, establishment_id: establishment.id, id: food.id

      must_response_with :success
      must_render_template :show
    end

    it 'should redirect when not logged user' do
      get :show, establishment_id: establishment.id, id: food.id

      must_redirect_to root_path
      flash[:alert].wont_be_nil
    end

    it 'should redirect when not exists' do
      login_user

      get :show, establishment_id: 203, id: 300

      must_redirect_to dashboard_establishment_foods_path
      flash[:alert].wont_be_nil
    end
  end

  describe 'GET new' do
    it 'should render new when logged user' do
      login_user

      get :new, establishment_id: establishment.id

      must_response_with :success
      must_render_template :new
    end

    it 'should not render when not logged user' do
      get :new, establishment_id: establishment.id

      must_redirect_to root_path
      flash[:alert].wont_be_nil
    end
  end

  describe 'GET edit' do
    it 'should render edit when logged user and exists a food ' do
      login_user

      get :edit, establishment_id: establishment.id, id: food.id

      must_response_with :success
      must_render_template :edit
    end

    it 'should redirect when not logged user' do
      get :edit, establishment_id: establishment.id, id: food.id

      must_redirect_to root_path
      flash[:alert].wont_be_nil
    end
  end
end
